"""
Полный модуль вычисления факториала
Расширенная настраивая валидация и кэширование
"""

from functools import lru_cache  # импорт модуля для хранения частых вызовов
from math import factorial  # иморт модуля math для работы с большими числами

@lru_cache(maxsize = 128)  # создание кэша, для хранения частых запросов и оптимизации
def fact_num(num: int) -> int:

    """Функция принимает провереное, валидное число
    Возвращает фаториал этого числа и кэширует его"""

    return factorial(num)


def validate_num(
    valid_min: int = 1,
    valid_max: int = None,
    zero_in_case: bool = False,
    ) -> int:

    """Функция принимает ввод и применяет доп проверки:

    valid_min - минимальное допустимое значение, по умолчанию 1
    valid_max - максимальное допустимое значение, по умолчанию без ограничений
    zero_in_case - разрешён ли ноль

    Каждый ввод проверяется на целую группу ошибок, чтобы исключить поломки
    Возвращает ошибки по каждой категории отдельно, запускает цикл снова, при ошибке

    Если ошибок нету, то возвращает валидное число, введённое юзером"""

    while True:

        num_str = input('Введите целое положительное число: ').strip()  # принимает число, возвращает копию строчки без пробелов

        if not num_str:  # проверка пустого ввода, ошибка при пустом вводе
            print('Пустая строчка, вы ничего не ввели.\nПовторите ввод.\n')
            continue

        if num_str[0] == '-' and num_str[1:].isdigit():  # проверка на то есть ли унарный минус вначале, ошибка при отрицательных числах
            print(f'Отрицательное число "{num_str}" не подходит.\nПовторите ввод.\n')
            continue

        if not num_str.isdigit():  # проверка ввода именно чисел, принимает только числа, остальное всё вызывает ошибку
            print(f'"{num_str}" — содержит недопустимые символы.\nРазрешены только позитивные целые числа.')
            print('Повторите ввод.\n')
            continue

        if num_str.startswith('0') and len(num_str) > 1:  # проверка чисел с ведущими нулями, возвращает ошибку если есть ведущие нули
            print(f'Число не должно начинаться с нуля (ведущие нули запрещены).\nПовторите ввод.\n')
            continue

        if not zero_in_case and num_str == '0':  # проверка на ноль, пусть и есть факториал нуля, в условиях задчи принимать необходимо только положительные числа в математическом плане
            print('Ноль не является положительным числом, пусть и имеет фаkториал равный 1.')
            print('Введите число от 1 и выше.\n')
            continue

        num = int(num_str)  # меняет тип данных на целое число после всех проверок

        if num < valid_min:  # проверяет, что число больше минимального значения, иначе ошибка
            print('Вы ввели слишком маленькое число.')
            print(f"Число должно быть не меньше {valid_min}.\n")
            continue

        if valid_max is not None and num > valid_max:  # проверяет, что число меньuше максимального значения, иначе ошибка
            print('Вы ввели слишком большое число.')
            print(f"Число должно быть не больше {valid_max}.")
            continue

        return num


def main():

    """Основная функция, запускает проверку, а потом вычисление факториала
    Однократная сессия, закрывается после выдачи факториала на экран
    
    Применение:
    Bведите валидное значение, программа выведет число и результат факториала.
    Проверки для min=max 
    """
    
    print('Добро пожаловать в расчёт факториала от числа!')

    """Запускает функцию проверки числа с вводными доп.. проверками"""
    num = validate_num(valid_min = 1,  # минимальное ограничение проверки числа, менять здесь для установки минимального уровня
                        valid_max = None,  # максимальное ограничение проверки числа, менять здесь для установки максимального уровня
                        zero_in_case = False)  # принимает ли программа ноль для расчёта
       
    fact = fact_num(num)  # вводим переменую и присваием значение факториала из функции
    print(f'\nФакториал Числа "{num}" равен {fact}.')  # вывод числа и его факториала


main()  # запуск однократный (в условиях 2.5, которое относится к 2.2 так указано: Если ввод корректен, завершать выполнение программы)
        # можно создать цикл для нескольких итераций